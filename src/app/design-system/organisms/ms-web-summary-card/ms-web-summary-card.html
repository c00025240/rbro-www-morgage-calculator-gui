<div class="ms-web-summary-card">
	<ms-card [maxWidth]="false">
		<div class="ms-web-summary-card__content">
			<!-- Error banner inside card when personalized offer fails -->
			<div *ngIf="showErrorBanner" class="ms-web-summary-card__error">
				<div class="ms-error-banner" role="alert" aria-live="assertive">
					<span class="ms-error-banner__icon" aria-hidden="true">
						<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M12 2C12.3631 2 12.6976 2.19718 12.874 2.51465L22.874 20.5146C23.0459 20.8242 23.0417 21.2016 22.8623 21.5068C22.6826 21.8122 22.3543 22 22 22H1.99998C1.64566 22 1.31736 21.8122 1.13767 21.5068C0.958254 21.2016 0.954051 20.8242 1.12595 20.5146L11.126 2.51465C11.3023 2.19718 11.6368 2 12 2ZM3.6992 20H20.3008L12 5.05957L3.6992 20ZM12 16.25C12.6903 16.25 13.25 16.8096 13.25 17.5C13.25 18.1904 12.6903 18.75 12 18.75C11.3096 18.75 10.75 18.1904 10.75 17.5C10.75 16.8096 11.3096 16.25 12 16.25ZM13 15H11V10H13V15Z" fill="var(--error-default)"/>
						</svg>
					</span>
					<span class="ms-error-banner__text">{{ errorText }}</span>
				</div>
			</div>
			<!-- Offers area: three columns in one card -->
			<div class="ms-web-summary-card__offers-grid" *ngIf="!showErrorBanner && columns?.length; else legacySingle" [ngClass]="{
				'cols-1': columns?.length === 1,
				'cols-2': columns?.length === 2,
				'cols-3': (columns?.length || 0) >= 3
			}">
				<div class="ms-web-summary-card__offer-col" *ngFor="let col of columns; let i = index">
					<div class="ms-web-summary-card__combined-box">
						<div class="ms-web-summary-card__offer-heading" *ngIf="col.title">{{ col.title }}</div>
						<div class="ms-web-summary-card__kpi">
							<div class="ms-web-summary-card__kpi-label">Rata lunară</div>
							<div class="ms-web-summary-card__kpi-amount">
								<span class="value">{{ col.rightTop?.amount }}</span>
								<span class="currency">{{ col.rightTop?.currency }}</span>
							</div>
						</div>
						<div class="ms-web-summary-card__secondary-info" *ngIf="col.leftTop">
							<span class="label">Dobândă inițială</span>
							<span class="value">{{ col.leftTop.amount }} {{ col.leftTop.currency }}</span>
						</div>
						<div *ngIf="col.extraDetails?.length" class="ms-web-summary-card__extra">
							<div class="ms-web-summary-card__separator"></div>
							<div class="ms-web-summary-card__extra-header" (click)="toggleDetailsIndex(i)">
								<span class="ms-web-summary-card__extra-title">Sumar calcule</span>
								<span class="ms-web-summary-card__extra-caret">
									<svg *ngIf="!isExpandedIndex(i)" class="caret-svg" width="28" height="28" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
										<circle cx="12" cy="12" r="11" fill="var(--color-bg-secondary)"/>
										<path d="M10 7l6 5-6 5V7z" fill="currentColor"/>
									</svg>
									<svg *ngIf="isExpandedIndex(i)" class="caret-svg" width="28" height="28" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
										<circle cx="12" cy="12" r="11" fill="var(--color-bg-secondary)"/>
										<path d="M7 10l5 6 5-6H7z" fill="currentColor"/>
									</svg>
								</span>
							</div>
							<div *ngIf="isExpandedIndex(i)" class="ms-web-summary-card__extra-list">
								<ng-container *ngFor="let row of col.extraDetails">
									<ng-container *ngIf="row.label || row.value; else spacerTpl">
										<div class="ms-web-summary-card__extra-row">
											<div *ngIf="row.label" class="ms-web-summary-card__extra-label">{{ row.label }}</div>
											<div class="ms-web-summary-card__extra-value">{{ row.value }}</div>
										</div>
									</ng-container>
								</ng-container>
								<ng-template #spacerTpl>
									<div class="ms-web-summary-card__extra-spacer"></div>
								</ng-template>
							</div>
						</div>
				</div>
			</div>
			</div>
			<ng-template #legacySingle>
				<div *ngIf="!showErrorBanner">
				<div class="ms-web-summary-card__offer-col">
					<ms-amount-combo [leftAmount]="leftTopAmount" [rightAmount]="rightTopAmount"></ms-amount-combo>
					<ms-amount-combo *ngIf="leftBottomAmount && rightBottomAmount" [leftAmount]="leftBottomAmount" [rightAmount]="rightBottomAmount"></ms-amount-combo>
				</div>
				<div class="ms-web-summary-card__offer-col" *ngIf="extraDetails?.length">
					<div class="ms-web-summary-card__separator"></div>
					<div class="ms-web-summary-card__extra-header" (click)="toggleDetails()">
						<span class="ms-web-summary-card__extra-title">Sumar calcule</span>
						<span class="ms-web-summary-card__extra-caret">
							<svg *ngIf="!isExpanded" class="caret-svg" width="28" height="28" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
								<circle cx="12" cy="12" r="11" fill="var(--color-bg-secondary)"/>
								<path d="M10 7l6 5-6 5V7z" fill="currentColor"/>
							</svg>
							<svg *ngIf="isExpanded" class="caret-svg" width="28" height="28" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
								<circle cx="12" cy="12" r="11" fill="var(--color-bg-secondary)"/>
								<path d="M7 10l5 6 5-6H7z" fill="currentColor"/>
							</svg>
						</span>
					</div>
					<div *ngIf="isExpanded" class="ms-web-summary-card__extra-list">
						<ng-container *ngFor="let row of extraDetails">
							<ng-container *ngIf="row.label || row.value; else spacerTpl">
								<div class="ms-web-summary-card__extra-row">
									<div *ngIf="row.label" class="ms-web-summary-card__extra-label">{{ row.label }}</div>
									<div class="ms-web-summary-card__extra-value">{{ row.value }}</div>
								</div>
							</ng-container>
						</ng-container>
						<ng-template #spacerTpl>
							<div class="ms-web-summary-card__extra-spacer"></div>
						</ng-template>
					</div>
				</div>
				</div>
			</ng-template>

			<!-- Info cells -->
			<div class="ms-web-summary-card__stack-12">
				<ms-info-contained-cell *ngIf="topInfoText" type="info" [text]="topInfoText"></ms-info-contained-cell>
				<ms-info-contained-cell *ngIf="bottomInfoText" type="info" [text]="bottomInfoText"></ms-info-contained-cell>
			</div>

			<!-- Actions area -->
			<div class="ms-web-summary-card__stack-12">
				<ms-button-primary [label]="primaryButtonLabel" (clicked)="onPrimaryClick()"></ms-button-primary>
				<div class="ms-web-summary-card__footnote">{{ footnoteText }}</div>
			</div>
		</div>
	</ms-card>
</div> 