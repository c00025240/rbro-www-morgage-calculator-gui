<ms-page-shell 
  [surface]="surface"
  [fullHeight]="true"
  [scrollable]="false">
  
  <!-- Sticky Header (Desktop & Mobile) -->
  <ms-header
    [title]="''"
    [logoSrc]="'assets/logos/long-logo-light.svg'"
    [logoAlt]="'Raiffeisen Bank'"
    [backLabel]="headerBackLabel"
    [surface]="surface"
    [primaryAction]="headerPrimaryAction"
    [secondaryAction]="headerSecondaryAction"
    [showBackButton]="false"
    (backClicked)="onHeaderBackClick($event)"
    (primaryActionClicked)="onHeaderPrimaryActionClick($event)"
    (secondaryActionClicked)="onHeaderSecondaryActionClick($event)"
    (logoClicked)="onHeaderLogoClick($event)">
  </ms-header>

  <!-- Desktop Split-Screen Layout (≥1024px) -->
  <div class="ms-simulator-page__desktop-layout">
    
    <!-- Left Panel: Controls (50% width) -->
    <div class="ms-simulator-page__left-panel">
      <div class="ms-simulator-page__left-content">
        
        <!-- Simulator Hero Section -->
        <div class="ms-simulator-page__hero">
          <ms-simulator-swap-hero
            [variant]="heroVariant"
            [label]="heroLabel"
            [chipLabel]="heroChipLabel"
            [surface]="surface"
            [hasClose]="heroHasClose"
            [disabled]="heroDisabled"
            (chipClicked)="onHeroChipClick()"
            (closeClicked)="onHeroCloseClick()">
          </ms-simulator-swap-hero>
        </div>

        <!-- Simulator User Inputs Container -->
        <div class="simulatorUserInputs">
			<!-- 1) Venitul tau -->
			<ms-income-section
				[monthlyIncome]="monthlyIncome"
				[monthlyInstallments]="monthlyInstallments"
				[surface]="surface"
				(monthlyIncomeChange)="onMonthlyIncomeChange($event)"
				(monthlyInstallmentsChange)="onMonthlyInstallmentsChange($event)">
			</ms-income-section>

			<!-- 2) Varsta -->
			<ms-age
				[label]="'Spune-mi cati ani ai'"
				[placeholder]="ageValue.toString()"
				[suffix]="ageSuffix"
				[min]="ageMin"
				[max]="ageMax"
				[step]="ageStep"
				[value]="ageValue"
				[disabled]="ageDisabled"
				[surface]="surface"
				(valueChange)="onAgeValueChange($event)">
			</ms-age>

			<!-- 7) Perioada imprumutului -->
			<ms-loan-duration
					[label]="loanDurationLabel"
					[placeholder]="loanDurationPlaceholder"
					[suffix]="loanDurationSuffix"
					[min]="loanDurationMin"
					[max]="loanDurationMax"
					[step]="loanDurationStep"
					[value]="loanDurationValue"
					[disabled]="loanDurationDisabled"
					[surface]="surface"
					(valueChange)="onLoanDurationValueChange($event)"
					(focused)="onLoanDurationFocused($event)"
					(blurred)="onLoanDurationBlurred($event)">
			</ms-loan-duration>

			<!-- 3) Zona -->
			<ms-property-location-section
				[selectedCounty]="selectedCounty"
				[selectedCity]="selectedCity"
				[countyOptions]="countyOptions"
				[cityOptions]="cityOptions"
				[surface]="surface"
				(countyChange)="onCountyChange($event)"
				(cityChange)="onCityChange($event)">
			</ms-property-location-section>

			<!-- 4) Status proprietar -->
			<ms-owner-status *ngIf="selectedProductType !== 'refinantare'"
				[owner]="hasGuaranteeProperty"
				[surface]="surface"
				(ownerChange)="onGuaranteePropertyChange($event)">
			</ms-owner-status>

			<!-- 5) Valoarea proprietatii -->
			<ms-property-value-input
				[label]="propertyLabel"
				[helperText]="propertyHelperText"
				[placeholder]="propertyPlaceholder"
				[currency]="propertyCurrency"
				[min]="propertyMin"
				[max]="propertyMax"
				[step]="propertyStep"
				[eurConversionRate]="propertyEurConversionRate"
				[value]="propertyValue"
				[disabled]="propertyDisabled"
				[surface]="surface"
				(valueChange)="onPropertyValueChange($event)"
				(focused)="onPropertyFocused($event)"
				(blurred)="onPropertyBlurred($event)">
			</ms-property-value-input>

			<!-- 6) Avans -->
			<ms-downpayment *ngIf="selectedProductType !== 'refinantare'" 
				[label]="selectedProductType === 'constructie-renovare' ? 'Contributie proprie' : 'Avans'"
				[valueProp]="downPaymentAmount"
				[disabledProp]="downPaymentDisabled"
				[infoNote]="downPaymentInfoNote"
				[infoNoteType]="downPaymentInfoType"
				(valueChange)="onDownPaymentAmountChange($event)">
			</ms-downpayment>
 
 			<!-- Info Cell -->
 			<ms-info-contained-cell
 				type="info"
 				[text]="'Suma solicitata: ' + requestedAmount.toLocaleString('ro-RO', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' Lei'">
 			</ms-info-contained-cell>
 			
 			<!-- Interest Preferences Section -->
 			<ms-interest-preferences-section
 				[rateType]="rateType"
 				[interestType]="interestType"
 				[surface]="surface"
 				(rateTypeChange)="onRateTypeChange($event)"
 				(interestTypeChange)="onInterestTypeChange($event)">
 			</ms-interest-preferences-section>
 			
 			<!-- Interest Reduction Section (owner toggle removed) -->
 			<ms-interest-reduction-section
 				[lifeInsurance]="lifeInsurance"
 				[salaryTransfer]="salaryTransfer"
 				[greenCertificate]="greenCertificate"
 				[surface]="surface"
 				[savingsInsurance]="calculationResponse?.loanCosts?.discounts?.discountAmountInsurance"
 				[savingsSalary]="calculationResponse?.loanCosts?.discounts?.discountAmountHasSalaryInTheBank"
 				[savingsGreen]="calculationResponse?.loanCosts?.discounts?.discountAmountCasaVerde"
 				[totalSavingsAmount]="calculationResponse?.loanCosts?.totalDiscountsValues?.totalDiscountInstallment"
 				(lifeInsuranceChange)="onLifeInsuranceChange($event)"
 				(salaryTransferChange)="onSalaryTransferChange($event)"
 				(greenCertificateChange)="onGreenCertificateChange($event)">
 			</ms-interest-reduction-section>
 			
 			<!-- Future input components can be added here with automatic 24px gaps -->
 		</div>

      </div>
    </div>

    <!-- Right Panel: Summary (50% width) -->
    <div class="ms-simulator-page__right-panel">
      <div class="ms-simulator-page__right-content">
        <div class="ms-simulator-page__right-spacer"></div>
        
        <!-- Summary - Single Card With All Offers -->
        <div class="ms-simulator-page__right-content-grid">
        <div *ngIf="(calculationResponse || calculationResponseAllDiscounts || calculationResponseNoDiscounts) && !isLoading" class="ms-simulator-page__summary-card-wrapper">
          <ms-card-outside-title
            title="Ofertele tale"
            helperText="Comparatie intre variante"
            [hasHelper]="true"
            [surface]="surface">
          </ms-card-outside-title>
          <ms-web-summary-card
            [columns]="getWebSummaryColumns()"
            [primaryButtonLabel]="'Aplica in doar 2 minute'"
            [secondaryButtonLabel]="'Detalii oferta'"
            [topInfoText]="'Informatiile prezentate sunt pur orientative si nu antreneaza banca in angajamente contractuale. Suma maxima ce ti-ar putea fi oferita a fost calculata pe baza informatiilor furnizate. Pentru a afla informatii personalizate, suma exacta si perioada creditului solicita Scrisoarea de avizare financiara GRATUIT si FARA OBLIGATIA DE A CONTRACTA CREDITUL.'"
            [bottomInfoText]="''"
            [showErrorBanner]="showOffersErrorBanner"
            [errorText]="errorMessage || 'Ne pare rau! Cererea nu poate fi procesata.'"
            (primaryClicked)="onFooterPrimaryClick($event)"
            (secondaryClicked)="onFooterDetailsClick($event)">
          </ms-web-summary-card>
        </div>
        
        </div>
        
        <!-- Loading State -->
        <ms-card *ngIf="isLoading" class="ms-simulator-page__loading-card">
          <div class="ms-simulator-page__loading-content">
            <ms-progress-spinner></ms-progress-spinner>
            <p>Se calculează oferta...</p>
          </div>
        </ms-card>
        
        

      </div>
    </div>

  </div>

  <!-- Mobile Layout (<1024px) - Current behavior maintained -->
  <div class="ms-simulator-page__mobile-layout">
    
    <!-- Main Content Area -->
    <main class="ms-simulator-page__content">
      
      <!-- Simulator Hero Section (Edge-to-Edge) -->
      <div class="ms-simulator-page__hero">
        <ms-simulator-swap-hero
          [variant]="heroVariant"
          [label]="heroLabel"
          [chipLabel]="heroChipLabel"
          [surface]="surface"
          [hasClose]="heroHasClose"
          [disabled]="heroDisabled"
          (chipClicked)="onHeroChipClick()"
          (closeClicked)="onHeroCloseClick()">
        </ms-simulator-swap-hero>
      </div>

      <!-- Simulator User Inputs Container -->
      <div class="simulatorUserInputs">
			<!-- 1) Venitul tau -->
			<ms-income-section
				[monthlyIncome]="monthlyIncome"
				[monthlyInstallments]="monthlyInstallments"
				[surface]="surface"
				(monthlyIncomeChange)="onMonthlyIncomeChange($event)"
				(monthlyInstallmentsChange)="onMonthlyInstallmentsChange($event)">
			</ms-income-section>

			<!-- 2) Varsta -->
            <ms-age
				[label]="'Spune-mi cati ani ai'"
				[placeholder]="ageValue.toString()"
				[suffix]="ageSuffix"
				[min]="ageMin"
				[max]="ageMax"
				[step]="ageStep"
				[value]="ageValue"
				[disabled]="ageDisabled"
				[surface]="surface"
				(valueChange)="onAgeValueChange($event)">
			</ms-age>

		  <!-- 7) Perioada imprumutului -->
		  <ms-loan-duration
				  [label]="loanDurationLabel"
				  [placeholder]="loanDurationPlaceholder"
				  [suffix]="loanDurationSuffix"
				  [min]="loanDurationMin"
				  [max]="loanDurationMax"
				  [step]="loanDurationStep"
				  [value]="loanDurationValue"
				  [disabled]="loanDurationDisabled"
				  [surface]="surface"
				  (valueChange)="onLoanDurationValueChange($event)"
				  (focused)="onLoanDurationFocused($event)"
				  (blurred)="onLoanDurationBlurred($event)">
		  </ms-loan-duration>

			<!-- 3) Zona -->
			<ms-property-location-section
				[selectedCounty]="selectedCounty"
				[selectedCity]="selectedCity"
				[countyOptions]="countyOptions"
				[cityOptions]="cityOptions"
				[surface]="surface"
				(countyChange)="onCountyChange($event)"
				(cityChange)="onCityChange($event)">
			</ms-property-location-section>

			<!-- 4) Status proprietar -->
			<ms-owner-status *ngIf="selectedProductType !== 'refinantare'"
				[owner]="hasGuaranteeProperty"
				[surface]="surface"
				(ownerChange)="onGuaranteePropertyChange($event)">
			</ms-owner-status>

			<!-- 5) Valoarea proprietatii -->
			<ms-property-value-input
				[label]="propertyLabel"
				[helperText]="propertyHelperText"
				[placeholder]="propertyPlaceholder"
				[currency]="propertyCurrency"
				[min]="propertyMin"
				[max]="propertyMax"
				[step]="propertyStep"
				[eurConversionRate]="propertyEurConversionRate"
				[value]="propertyValue"
				[disabled]="propertyDisabled"
				[surface]="surface"
				(valueChange)="onPropertyValueChange($event)"
				(focused)="onPropertyFocused($event)"
				(blurred)="onPropertyBlurred($event)">
			</ms-property-value-input>

			<!-- 6) Avans -->
			<ms-downpayment *ngIf="selectedProductType !== 'refinantare'" 
				[label]="selectedProductType === 'constructie-renovare' ? 'Contributie proprie' : 'Avans'"
				[valueProp]="downPaymentAmount"
				[disabledProp]="downPaymentDisabled"
				[infoNote]="downPaymentInfoNote"
				[infoNoteType]="downPaymentInfoType"
				(valueChange)="onDownPaymentAmountChange($event)">
			</ms-downpayment>
 			
 			<!-- Info Cell -->
 			<ms-info-contained-cell
 				type="info"
 				[text]="'Suma solicitata: ' + requestedAmount.toLocaleString('ro-RO', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' Lei'">
 			</ms-info-contained-cell>
 			
 			<!-- Interest Preferences Section -->
 			<ms-interest-preferences-section
 				[rateType]="rateType"
 				[interestType]="interestType"
 				[surface]="surface"
 				(rateTypeChange)="onRateTypeChange($event)"
 				(interestTypeChange)="onInterestTypeChange($event)">
 			</ms-interest-preferences-section>
 			
 			<!-- Interest Reduction Section (owner toggle removed) -->
 			<ms-interest-reduction-section
 				[lifeInsurance]="lifeInsurance"
 				[salaryTransfer]="salaryTransfer"
 				[greenCertificate]="greenCertificate"
 				[surface]="surface"
 				[savingsInsurance]="calculationResponse?.loanCosts?.discounts?.discountAmountInsurance"
 				[savingsSalary]="calculationResponse?.loanCosts?.discounts?.discountAmountHasSalaryInTheBank"
 				[savingsGreen]="calculationResponse?.loanCosts?.discounts?.discountAmountCasaVerde"
 				[totalSavingsAmount]="calculationResponse?.loanCosts?.totalDiscountsValues?.totalDiscountInstallment"
 				(lifeInsuranceChange)="onLifeInsuranceChange($event)"
 				(salaryTransferChange)="onSalaryTransferChange($event)"
 				(greenCertificateChange)="onGreenCertificateChange($event)">
 			</ms-interest-reduction-section>
 			
 			<!-- Future input components can be added here with automatic 24px gaps -->
 		</div>
      
    </main>

  </div>

  <!-- Sticky Footer (Mobile & Tablet Only) -->
  <ms-sticky-footer
    class="ms-simulator-page__footer"
    [leftAmount]="footerLeftAmount"
    [rightAmount]="footerRightAmount"
    [actions]="footerActions"
    [surface]="surface"
    [errorBannerText]="showOffersErrorBanner ? (errorMessage || 'Ne pare rau! Cererea nu poate fi procesata.') : undefined"
    (detailsClicked)="onFooterDetailsClick($event)"
    (primaryClicked)="onFooterPrimaryClick($event)"
    (shareClicked)="onFooterShareClick($event)">
  </ms-sticky-footer>

  <!-- Mobile/Tablet Summary Modal (shown only when pressing Detalii) -->
  <ms-mobile-summary-modal
    *ngIf="isMobileSummaryVisible && calculationResponse"
    [offers]="getMobileOffers()"
    (closed)="onMobileSummaryClosed()"
    (applyClicked)="onMobileApplyClick()">
  </ms-mobile-summary-modal>

  <!-- Simulator Option Modal -->
  <simulator-option-modal
    [isVisible]="isSimulatorModalVisible"
    [surface]="surface === 'dark' ? 'dark' : 'light'"
    (closeModal)="onSimulatorModalClose()"
    (optionSelected)="onSimulatorOptionSelected($event)">
  </simulator-option-modal>

</ms-page-shell> 